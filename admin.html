<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê´€ë¦¬ì í˜ì´ì§€ - íšŒì› ê´€ë¦¬</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --font-sans: 'Noto Sans KR', sans-serif;
      --color-primary: #5d4037;
      --color-primary-dark: #4a332c;
      --color-accent: #8d6e63;
    }

    body {
      font-family: var(--font-sans);
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: var(--color-primary);
      color: white;
      padding: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 1.8em;
    }

    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .content {
      padding: 30px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--color-accent), var(--color-primary));
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2em;
      margin-bottom: 5px;
    }

    .stat-card p {
      opacity: 0.9;
      font-size: 0.9em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      background: #f9f9f9;
      font-weight: 600;
      color: var(--color-primary);
    }

    tr:hover {
      background: #f9f9f9;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 0.8em;
      font-weight: 600;
    }

    .badge-admin {
      background: #ff6f00;
      color: white;
    }

    .badge-user {
      background: #4caf50;
      color: white;
    }

    .permission-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .lang-badge {
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 0.75em;
      background: #e3f2fd;
      color: #1976d2;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      transition: all 0.3s;
      font-family: var(--font-sans);
    }

    .btn-edit {
      background: var(--color-accent);
      color: white;
    }

    .btn-edit:hover {
      background: var(--color-primary);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e0e0e0;
    }

    .modal-header h2 {
      color: var(--color-primary);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }

    .permission-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .permission-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .permission-item input[type="checkbox"] {
      cursor: pointer;
    }

    .permission-item label {
      margin: 0;
      cursor: pointer;
      font-size: 0.9em;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .btn-save {
      flex: 1;
      background: var(--color-primary);
      color: white;
      padding: 12px;
    }

    .btn-save:hover {
      background: var(--color-primary-dark);
    }

    .btn-cancel {
      flex: 1;
      background: #999;
      color: white;
      padding: 12px;
    }

    .btn-cancel:hover {
      background: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>ğŸ‘¤ íšŒì› ê´€ë¦¬</h1>
        <p>ê´€ë¦¬ì í˜ì´ì§€</p>
      </div>
      <button class="logout-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div class="content">
      <div class="stats">
        <div class="stat-card">
          <h3 id="total-users">0</h3>
          <p>ì „ì²´ íšŒì›</p>
        </div>
        <div class="stat-card">
          <h3 id="admin-count">0</h3>
          <p>ê´€ë¦¬ì</p>
        </div>
        <div class="stat-card">
          <h3 id="user-count">0</h3>
          <p>ì¼ë°˜ íšŒì›</p>
        </div>
      </div>

      <table id="users-table">
        <thead>
          <tr>
            <th>ì‚¬ìš©ìëª…</th>
            <th>ì´ë¦„</th>
            <th>ì´ë©”ì¼</th>
            <th>ì—­í• </th>
            <th>ì–¸ì–´ ê¶Œí•œ</th>
            <th>ê°€ì…ì¼</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="users-tbody">
        </tbody>
      </table>
    </div>
  </div>

  <!-- Edit Permissions Modal -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ì–¸ì–´ ê¶Œí•œ ìˆ˜ì •</h2>
        <p id="edit-user-name"></p>
      </div>
      
      <div class="form-group">
        <label>ì—´ëŒ ê°€ëŠ¥í•œ ì–¸ì–´ ì„ íƒ</label>
        <div class="permission-grid">
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-ko" value="ko" checked disabled>
            <label for="edit-lang-ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-en" value="en">
            <label for="edit-lang-en">ğŸ‡ºğŸ‡¸ English</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-zh" value="zh">
            <label for="edit-lang-zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-ja" value="ja">
            <label for="edit-lang-ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-es" value="es">
            <label for="edit-lang-es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-fr" value="fr">
            <label for="edit-lang-fr">ğŸ‡«ğŸ‡· FranÃ§ais</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-ru" value="ru">
            <label for="edit-lang-ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</label>
          </div>
          <div class="permission-item">
            <input type="checkbox" id="edit-lang-ar" value="ar">
            <label for="edit-lang-ar">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</label>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn btn-save" onclick="savePermissions()">ì €ì¥</button>
        <button class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <script>
    let currentEditUser = null;

    // Check admin authentication
    const currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
    if (!currentUser) {
      window.location.href = 'index.html';
    } else {
      const user = JSON.parse(currentUser);
      if (user.role !== 'admin') {
        alert('ê´€ë¦¬ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        window.location.href = 'book.html';
      }
    }

    // Load users
    function loadUsers() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      
      // Update stats
      document.getElementById('total-users').textContent = users.length;
      document.getElementById('admin-count').textContent = users.filter(u => u.role === 'admin').length;
      document.getElementById('user-count').textContent = users.filter(u => u.role === 'user').length;

      // Render table
      const tbody = document.getElementById('users-tbody');
      tbody.innerHTML = '';

      users.forEach(user => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${user.username}</td>
          <td>${user.name}</td>
          <td>${user.email}</td>
          <td>
            <span class="badge ${user.role === 'admin' ? 'badge-admin' : 'badge-user'}">
              ${user.role === 'admin' ? 'ê´€ë¦¬ì' : 'ì¼ë°˜íšŒì›'}
            </span>
          </td>
          <td>
            <div class="permission-badges">
              ${user.permissions.map(lang => {
                const langNames = {ko: 'ğŸ‡°ğŸ‡· í•œêµ­ì–´', en: 'ğŸ‡ºğŸ‡¸ English', zh: 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡', ja: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª', 
                                  es: 'ğŸ‡ªğŸ‡¸ EspaÃ±ol', fr: 'ğŸ‡«ğŸ‡· FranÃ§ais', ru: 'ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹', ar: 'ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ'};
                return `<span class="lang-badge">${langNames[lang] || lang}</span>`;
              }).join('')}
            </div>
          </td>
          <td>${new Date(user.createdAt).toLocaleDateString()}</td>
          <td>
            ${user.role !== 'admin' ? 
              `<button class="btn btn-edit" onclick="editPermissions('${user.username}')">ê¶Œí•œ ìˆ˜ì •</button>` : 
              '-'}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Edit permissions
    function editPermissions(username) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.username === username);
      
      if (!user) return;
      
      currentEditUser = username;
      document.getElementById('edit-user-name').textContent = `${user.name} (${user.username})`;
      
      // Reset checkboxes
      ['ko', 'en', 'zh', 'ja', 'es', 'fr', 'ru', 'ar'].forEach(lang => {
        const checkbox = document.getElementById(`edit-lang-${lang}`);
        if (checkbox && !checkbox.disabled) {
          checkbox.checked = user.permissions.includes(lang);
        }
      });
      
      document.getElementById('edit-modal').classList.add('active');
    }

    // Save permissions
    function savePermissions() {
      if (!currentEditUser) return;
      
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const userIndex = users.findIndex(u => u.username === currentEditUser);
      
      if (userIndex === -1) return;
      
      // Get selected permissions
      const permissions = ['ko']; // Korean is always included
      ['en', 'zh', 'ja', 'es', 'fr', 'ru', 'ar'].forEach(lang => {
        const checkbox = document.getElementById(`edit-lang-${lang}`);
        if (checkbox && checkbox.checked) {
          permissions.push(lang);
        }
      });
      
      // Update user
      users[userIndex].permissions = permissions;
      localStorage.setItem('users', JSON.stringify(users));
      
      // Update current user session if editing self
      const currentUserData = JSON.parse(localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser'));
      if (currentUserData && currentUserData.username === currentEditUser) {
        currentUserData.permissions = permissions;
        if (localStorage.getItem('currentUser')) {
          localStorage.setItem('currentUser', JSON.stringify(currentUserData));
        } else {
          sessionStorage.setItem('currentUser', JSON.stringify(currentUserData));
        }
      }
      
      closeModal();
      loadUsers();
      alert('ê¶Œí•œì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // Close modal
    function closeModal() {
      document.getElementById('edit-modal').classList.remove('active');
      currentEditUser = null;
    }

    // Logout
    function logout() {
      localStorage.removeItem('currentUser');
      sessionStorage.removeItem('currentUser');
      window.location.href = 'index.html';
    }

    // Close modal when clicking outside
    document.getElementById('edit-modal').addEventListener('click', (e) => {
      if (e.target.id === 'edit-modal') {
        closeModal();
      }
    });

    // Load users on page load
    loadUsers();
  </script>
</body>
</html>
